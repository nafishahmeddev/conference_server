(this.webpackJsonpxpeed_conference_react=this.webpackJsonpxpeed_conference_react||[]).push([[0],{1603:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n(66),r=n.n(a),i=(n(75),n(25)),s=n(4),o=n(0),u={page:{display:"flex",alignItems:"center",justifyContent:"center"}};var d=function(e){return Object(s.f)(),Object(o.jsx)("div",{id:"page",className:"room",style:u.page,children:Object(o.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=new FormData(e.target).get("room");window.location.href="/"+t},className:"login-form",children:[Object(o.jsx)("h3",{children:"Create or join room"}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Room"}),Object(o.jsx)("input",{type:"text",name:"room",placeholder:"please enter room name",required:!0})]}),Object(o.jsx)("div",{className:"input-group",children:Object(o.jsx)("button",{type:"submit",children:"Join Now"})})]})})},l=n(2),j=n.n(l),f=n(8),b=n(22),m=n(3),p=n(6),O=n(1604),v=n(69),x=n.n(v),h=n(70),g=n.n(h);function k(e,t){var n=e.id,a=e.stream,r=e.video_muted,i=e.audio_muted,s=e.name,u=e.self,d=void 0!==u&&u,l=e.onPinVideo,j=void 0===l?function(){}:l,f=Object(c.useRef)(),b=Object(c.useState)(!1),m=Object(p.a)(b,2),v=m[0],x=m[1];return Object(c.useEffect)((function(){if(a&&f.current&&(f.current.srcObject=a,f.current.play(),f.current.muted=d,!d)){var e=g()(a,{});e.on("speaking",(function(){x(!0)})),e.on("stopped_speaking",(function(){x(!1)}))}d||console.log(a)}),[a]),Object(c.useEffect)((function(){v&&j({id:n,stream:a,video_muted:r,audio_muted:i,name:s,self:d})}),[v]),Object(c.useEffect)((function(){return function(){x(null)}}),[]),Object(o.jsxs)("div",{onClick:function(e){return d?function(){}:j({stream:a,video_muted:r,audio_muted:i,name:s,self:d})},className:"".concat(v?"speaking":""," user-thumb"),children:[Object(o.jsxs)("header",{children:[Object(o.jsx)("button",{children:r?Object(o.jsx)(O.j,{size:14,color:"red"}):Object(o.jsx)(O.k,{size:14})}),Object(o.jsx)("button",{children:i?Object(o.jsx)(O.f,{color:"red",size:14}):Object(o.jsx)(O.g,{size:14})}),Object(o.jsx)("div",{}),!d&&Object(o.jsx)("button",{style:{alignSelf:"flex-end"},children:Object(o.jsx)(O.d,{size:14})})]}),Object(o.jsx)("footer",{children:Object(o.jsxs)("span",{className:"name",children:[s," ",d&&"(me)"]})}),Object(o.jsx)("video",{ref:f}),Object(o.jsx)("audio",{})]})}var y=n(34),w=n.n(y);function N(e,t){e.id,e.stream,e.video_muted,e.audio_muted;var n=e.name,a=(e.self,e.onSendMessage),r=void 0===a?function(e){}:a,i=e.signaling,s=e.participants,u=e.style,d=void 0===u?{}:u,l=Object(c.useState)([]),j=Object(p.a)(l,2),f=j[0],O=j[1];return Object(c.useEffect)((function(){f&&function(){var e=document.querySelector(".chat-screen > .messages");e&&(e.scrollTop=e.scrollHeight)}()}),[f]),Object(c.useEffect)((function(){return i.on("message",(function(e){var t=s.find((function(t){return t.id===e.from}));t&&O([].concat(Object(b.a)(f),[Object(m.a)(Object(m.a)({},e),{},{self:!1,time:new Date,name:t.name})]))})),function(){i.removeAllListeners("message")}})),Object(o.jsxs)("div",{className:"chat-screen",style:d,children:[Object(o.jsx)("h3",{children:"Messages"}),Object(o.jsx)("div",{className:"messages",children:f.map((function(e){return Object(o.jsxs)("div",{className:"message ".concat(e.self?"self":""),children:[Object(o.jsx)("span",{className:"name",children:e.name}),e.content,Object(o.jsx)("span",{className:"time",children:e.time.toString()})]})}))}),Object(o.jsx)("footer",{children:Object(o.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=new FormData(e.target),c=t.get("content"),a=t.get("type");r(c,a),e.target.reset(),O([].concat(Object(b.a)(f),[{type:a,content:c,name:n,self:!0,time:new Date}]))},children:[Object(o.jsx)("input",{type:"text",name:"content",placeholder:"Please type a message"}),Object(o.jsx)("input",{type:"hidden",value:"plain/text",name:"type"}),Object(o.jsx)("button",{type:"submit",children:"Send"})]})})]})}var S={page:{flexDirection:"column",display:"flex",alignItems:"center",justifyContent:"center"},content:{flex:1}},_=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";n=""!==n?"".concat(e?"from":"to"," ").concat(n):"",console.info(e?"%c \u2193":"%c \u2191","color: ".concat(e?"green":"red"),t,n)},D={iceServers:[{urls:"turn:34.224.213.192:3478",username:"xpeed",credential:"xpeed123"}]};var C=function(e){var t=Object(s.g)().room,n=Object(c.useState)(!1),a=Object(p.a)(n,2),r=a[0],i=a[1],u=Object(c.useState)(null),d=Object(p.a)(u,2),l=d[0],v=d[1],h=Object(c.useState)(null),g=Object(p.a)(h,2),y=g[0],C=g[1],E=Object(c.useState)([]),I=Object(p.a)(E,2),T=I[0],z=I[1],R=Object(c.useRef)([]),P=function(e){R.current=e,z(e)},F=Object(c.useState)(!1),V=Object(p.a)(F,2),q=V[0],M=V[1],L=Object(c.useState)(!0),A=Object(p.a)(L,2),J=A[0],U=A[1],B=Object(c.useState)(!1),G=Object(p.a)(B,2),H=G[0],W=G[1],Y=Object(c.useState)(null),K=Object(p.a)(Y,2),Q=K[0],X=K[1],Z=Object(c.useState)({}),$=Object(p.a)(Z,2),ee=$[0],te=$[1],ne=Object(c.useRef)(),ce=function(e,t){var n,c,a;R.current.find((function(t){return t.id===e}))?P(R.current.map((function(n){return n.id===e&&(n=Object(m.a)(Object(m.a)({},n),t)),n}))):(t.name=null!==(n=t.name)&&void 0!==n?n:"",t.email=null!==(c=t.email)&&void 0!==c?c:"email",t.id=null!==(a=t.id)&&void 0!==a?a:e,P([].concat(Object(b.a)(R.current),[t])))},ae=function(e){P(R.current.filter((function(t){return t.id!==e})))},re=function(e){var t=R.current.find((function(t){return t.id===e}))||{};return t.peer?t.peer:null},ie=function(e){ee.id!==e.id&&te(e)},se=function(){var e=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new RTCPeerConnection(D),y.stream.getTracks().forEach((function(e){return n.addTrack(e,y.stream)})),n.onicecandidate=function(e){e&&e.candidate&&(Q.emit("candidate",{to:t,candidate:e.candidate}),_(!1,"candidate",t))},n.onnegotiationneeded=function(){var e=Object(f.a)(j.a.mark((function e(c){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.createOffer();case 2:return a=e.sent,e.next=5,n.setLocalDescription(a);case 5:Q.emit("offer",{to:t,offer:n.localDescription}),_(!1,"offer",t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.ontrack=function(e){ce(t,{stream:e.streams[0]}),_(!0,"stream",t)},_(!1,"offer",t),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=function(){var e=Object(f.a)(j.a.mark((function e(t,n){var c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=new RTCPeerConnection(D),y.stream.getTracks().forEach((function(e){return c.addTrack(e,y.stream)})),c.onicecandidate=function(e){e&&e.candidate&&(Q.emit("candidate",{to:t,candidate:e.candidate}),_(!1,"candidate",t))},c.ontrack=function(e){ce(t,{stream:e.streams[0]}),_(!0,"stream",t)},e.next=6,c.setRemoteDescription(new RTCSessionDescription(n));case 6:return e.t0=c,e.next=9,c.createAnswer();case 9:return e.t1=e.sent,e.next=12,e.t0.setLocalDescription.call(e.t0,e.t1);case 12:return Q.emit("answer",{to:t,answer:c.localDescription}),_(!1,"answer",t),e.abrupt("return",c);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ue=function(){var e=Object(f.a)(j.a.mark((function e(){var t=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.length>0&&void 0!==t[0]?t[0]:0,e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 4:e.sent,i(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),i(!1);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),de=function(){var e=Object(f.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t={video:[],audio:[]},navigator.mediaDevices.enumerateDevices().then(function(){var e=Object(f.a)(j.a.mark((function e(n){var c,a,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c=0;c<n.length;c++)a=n[c],r={info:a},"audioinput"===a.kind&&t.audio.push(r),"videoinput"===a.kind&&t.video.push(r);v(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}catch(n){alert(n.message)}case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=Object(f.a)(j.a.mark((function e(t){var n,c,a,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},n=y||{self:!0},n=Object(m.a)(Object(m.a)({},n),t),c=[],!t.audio&&!t.video){e.next=17;break}return y&&y.stream.getTracks().forEach((function(e){return e.stop()})),e.next=8,navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:n.audio}}});case 8:return a=e.sent.getTracks(),e.next=11,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:n.video}}});case 11:r=e.sent.getTracks(),c=(c=c.concat(a)).concat(r),n.stream=new MediaStream(c),n.audio_muted=!1,n.video_muted=!1;case 17:C(n),y||te(n);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){r?de():ue(0)}),[r]),Object(c.useEffect)((function(){!Q&&y&&function(){var e={room_id:t,name:y.name},n=x()("".concat("https://xpd.herokuapp.com","/conference"),{query:e});X(n)}(),y&&R.current.forEach((function(e){var t=e.peer,n=y.stream.getTracks();t.getSenders().forEach(function(){var e=Object(f.a)(j.a.mark((function e(t){var c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n.find((function(e){return e.kind===t.track.kind})),e.next=3,t.replaceTrack(c);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}),[y]),Object(c.useEffect)((function(){Q&&y&&(Q.on("join",function(){var e=Object(f.a)(j.a.mark((function e(t){var n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id&&t.name){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,se(t.id);case 4:n=e.sent,c={id:t.id,name:t.name,peer:n},ce(t.id,c),_(!0,"join",t.id);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Q.on("candidate",function(){var e=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=re(t.from)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.addIceCandidate(new RTCIceCandidate(t.candidate));case 5:_(!0,"candidate",t.from);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Q.on("answer",function(){var e=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.from){e.next=2;break}return e.abrupt("return");case 2:if(n=re(t.from)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,n.setRemoteDescription(new RTCSessionDescription(t.answer));case 7:_(!0,"answer",t.from);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Q.on("offer",function(){var e=Object(f.a)(j.a.mark((function e(t){var n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.from&&t.name){e.next=2;break}return e.abrupt("return");case 2:return _(!0,"offer",t.from),e.next=5,oe(t.from,t.offer);case 5:n=e.sent,c={id:t.from,name:t.name,peer:n},ce(t.from,c);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Q.on("audio_mute",(function(e){ce(e.id,{audio_muted:e.muted})})),Q.on("video_mute",(function(e){ce(e.id,{video_muted:e.muted})})),Q.on("detached",function(){var e=Object(f.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ae(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Q.on("connect",(function(e){console.log("connected")})),Q.emit("join"))}),[Q]),Object(c.useEffect)((function(){ee&&ee.stream&&ne.current&&(Object.is(ne.current.sercObject,ee.stream)||(ne.current.srcObject=ee.stream,ne.current.play(),ne.current.muted=!0))}),[ee]),Object(c.useEffect)((function(){!T.length&&y&&te(y)}),[T]),r?l?l&&!y?Object(o.jsx)(o.Fragment,{children:Object(o.jsx)("div",{id:"page",className:"room",style:Object(m.a)(Object(m.a)({},S.page),{},{backgroundImage:"url(https://loremflickr.com/1080/720/black)"}),children:Object(o.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=new FormData(e.target),n=t.get("name"),c=t.get("email"),a=t.get("audio"),r=t.get("video");le({name:n,email:c,audio:a,video:r})},className:"login-form",children:[Object(o.jsx)("h3",{children:"Get Started"}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Name"}),Object(o.jsx)("input",{type:"text",name:"name",placeholder:"please enter name",required:!0,defaultValue:w.a.name.findName()})]}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Email"}),Object(o.jsx)("input",{type:"email",name:"email",placeholder:"please enter email",required:!0,defaultValue:w.a.internet.email()})]}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Select video source"}),Object(o.jsx)("select",{name:"video",children:l.video.map((function(e){return Object(o.jsx)("option",{value:e.info.deviceId,children:e.info.label},e.deviceId)}))})]}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Select audio source"}),Object(o.jsx)("select",{name:"audio",children:l.audio.map((function(e){return Object(o.jsx)("option",{value:e.info.deviceId,children:e.info.label},e.deviceId)}))})]}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Room"}),Object(o.jsx)("input",{disabled:!0,type:"text",name:"name",placeholder:"please enter name",required:!0,defaultValue:t})]}),Object(o.jsx)("div",{className:"input-group",children:Object(o.jsx)("button",{type:"submit",children:"Enter"})})]})})}):Object(o.jsxs)("div",{id:"page",className:"room",style:S.page,children:[Object(o.jsxs)("div",{style:S.content,className:"content",children:[Object(o.jsxs)("div",{className:"pin-user-details",children:[Object(o.jsxs)("span",{children:[ee.name," ",ee.self?"(you)":""]}),Object(o.jsx)("i",{})]}),Object(o.jsx)("video",{ref:ne}),Object(o.jsx)(k,Object(m.a)(Object(m.a)({},y),{},{onPinVideo:ie}))]}),Object(o.jsxs)("div",{className:"bottom",children:[Object(o.jsxs)("div",{children:[Object(o.jsx)(O.a,{size:16}),Object(o.jsxs)("div",{children:[Object(o.jsxs)("span",{className:"title",children:["You are in ",t," room"]}),Object(o.jsxs)("span",{children:[T.length," together with you"]})]})]}),Object(o.jsx)("button",{className:"".concat(y.audio_muted?"active":""),onClick:function(e){(e=!y.audio_muted,y.stream)&&(y.stream.getAudioTracks()[0].enabled=!e);C(Object(m.a)(Object(m.a)({},y),{},{audio_muted:e})),Q.emit("audio_mute",e)},children:y.audio_muted?Object(o.jsx)(O.f,{size:20}):Object(o.jsx)(O.g,{size:20})}),Object(o.jsx)("button",{className:"".concat(y.video_muted?"active":""),onClick:function(e){(e=!y.video_muted,y.stream)&&(y.stream.getVideoTracks()[0].enabled=!e);C(Object(m.a)(Object(m.a)({},y),{},{video_muted:e})),Q.emit("video_mute",e)},children:y.video_muted?Object(o.jsx)(O.j,{size:20}):Object(o.jsx)(O.k,{size:20})}),Object(o.jsx)("button",{className:"".concat(q?"active":""),onClick:function(e){return M(!q)},children:q?Object(o.jsx)(O.c,{size:20}):Object(o.jsx)(O.i,{size:20})}),Object(o.jsx)("button",{style:{display:"none"},className:"".concat(J?"active":""),onClick:function(e){return U(!J)},children:J?Object(o.jsx)(O.c,{size:20}):Object(o.jsx)(O.h,{size:20})}),Object(o.jsx)("button",{className:"".concat(H?"active":""),onClick:function(e){return W(!H)},children:H?Object(o.jsx)(O.c,{size:20}):Object(o.jsx)(O.b,{size:20})}),Object(o.jsx)("button",{children:Object(o.jsx)(O.d,{size:20})}),Object(o.jsx)("button",{className:"drop-btn",onClick:function(e){return window.location.href="/"},children:Object(o.jsx)(O.e,{size:20})})]}),q&&Object(o.jsx)("div",{className:"settings-popup",children:Object(o.jsxs)("div",{className:"container",children:[Object(o.jsx)("h3",{children:"Settings"}),Object(o.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=new FormData(e.target),n=t.get("audio"),c=t.get("video");le({audio:n,video:c}),M(!1)},children:[Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Select video source"}),Object(o.jsx)("select",{name:"video",defaultValue:y.video,children:l.video.map((function(e){return Object(o.jsx)("option",{value:e.info.deviceId,children:e.info.label},e.deviceId)}))})]}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Select audio source"}),Object(o.jsx)("select",{name:"audio",defaultValue:y.audio,children:l.audio.map((function(e){return Object(o.jsx)("option",{value:e.info.deviceId,children:e.info.label},e.deviceId)}))})]}),Object(o.jsx)("div",{className:"input-group",children:Object(o.jsxs)("div",{children:[Object(o.jsx)("button",{variant:"danger",type:"button",onClick:function(e){return M(!1)},children:"Close"}),Object(o.jsx)("button",{type:"submit",children:"Save"})]})})]})]})}),J&&Object(o.jsx)("div",{className:"user-thumbs",children:T.map((function(e){return Object(c.createElement)(k,Object(m.a)(Object(m.a)({},e),{},{key:e.id,onPinVideo:ie}))}))}),Q&&T&&Object(o.jsx)(N,Object(m.a)(Object(m.a)({style:{display:"".concat(H?"inherit":"none")}},y),{},{onSendMessage:function(e){Q.emit("message",{content:e,type:"plain/text"})},signaling:Q,participants:T}))]}):Object(o.jsx)("div",{id:"page",className:"room",style:Object(m.a)(Object(m.a)({},S.page),{},{backgroundImage:"url(https://loremflickr.com/1080/720/black)"}),children:Object(o.jsxs)("div",{className:"login-form",children:[Object(o.jsx)("h3",{children:"Please wait.."}),Object(o.jsx)("p",{children:"While loading devices"})]})}):Object(o.jsx)("div",{id:"page",className:"room",style:Object(m.a)(Object(m.a)({},S.page),{},{backgroundImage:"url(https://loremflickr.com/1080/720/black)"}),children:Object(o.jsxs)("div",{className:"login-form",children:[Object(o.jsx)("h3",{children:"Permission required"}),Object(o.jsx)("p",{children:"Need permission to continue."})]})})};var E=function(){return Object(o.jsx)(i.a,{children:Object(o.jsxs)(s.c,{children:[Object(o.jsx)(s.a,{path:"/:room",component:C}),Object(o.jsx)(s.a,{path:"/",component:d})]})})},I=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,1605)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),r(e),i(e)}))};n(1600).config(),r.a.render(Object(o.jsx)(E,{}),document.getElementById("root")),I()},75:function(e,t,n){}},[[1603,1,2]]]);
//# sourceMappingURL=main.d5a2b3cd.chunk.js.map