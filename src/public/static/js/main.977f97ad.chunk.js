(this.webpackJsonpxpeed_conference_react=this.webpackJsonpxpeed_conference_react||[]).push([[0],{1602:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n(62),a=n.n(r),i=(n(73),n(24)),s=n(3),o=n(0),u={page:{display:"flex",alignItems:"center",justifyContent:"center"}};var d=function(e){return Object(s.f)(),Object(o.jsx)("div",{id:"page",className:"room",style:u.page,children:Object(o.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=new FormData(e.target).get("room");window.location.href="/"+t},className:"login-form",children:[Object(o.jsx)("h3",{children:"Create or join room"}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Room"}),Object(o.jsx)("input",{type:"text",name:"room",placeholder:"please enter room name",required:!0})]}),Object(o.jsx)("div",{className:"input-group",children:Object(o.jsx)("button",{type:"submit",children:"Join Now"})})]})})},l=n(2),j=n.n(l),f=n(7),b=n(67),m=n(5),p=n(10),O=n(1603),v=n(65),x=n.n(v),h=n(66),g=n.n(h);function k(e,t){var n=e.id,r=e.stream,a=e.video_muted,i=e.audio_muted,s=e.name,u=e.self,d=void 0!==u&&u,l=e.onPinVideo,j=void 0===l?function(){}:l,f=Object(c.useRef)(),b=Object(c.useState)(!1),m=Object(p.a)(b,2),v=m[0],x=m[1];return Object(c.useEffect)((function(){if(r&&f.current&&(f.current.srcObject=r,f.current.play(),f.current.muted=d,!d)){var e=g()(r,{});e.on("speaking",(function(){x(!0)})),e.on("stopped_speaking",(function(){x(!1)}))}d||console.log(r)}),[r]),Object(c.useEffect)((function(){v&&j({id:n,stream:r,video_muted:a,audio_muted:i,name:s,self:d})}),[v]),Object(c.useEffect)((function(){return function(){x(null)}}),[]),Object(o.jsxs)("div",{onClick:function(e){return d?function(){}:j({stream:r,video_muted:a,audio_muted:i,name:s,self:d})},className:"".concat(v?"speaking":""," user-thumb"),children:[Object(o.jsxs)("header",{children:[Object(o.jsx)("button",{children:a?Object(o.jsx)(O.i,{size:14,color:"red"}):Object(o.jsx)(O.j,{size:14})}),Object(o.jsx)("button",{children:i?Object(o.jsx)(O.e,{color:"red",size:14}):Object(o.jsx)(O.f,{size:14})}),Object(o.jsx)("div",{}),!d&&Object(o.jsx)("button",{style:{alignSelf:"flex-end"},children:Object(o.jsx)(O.c,{size:14})})]}),Object(o.jsx)("footer",{children:Object(o.jsxs)("span",{className:"name",children:[s," ",d&&"(me)"]})}),Object(o.jsx)("video",{ref:f}),Object(o.jsx)("audio",{})]})}var w=n(32),y=n.n(w),N={page:{flexDirection:"column",display:"flex",alignItems:"center",justifyContent:"center"},content:{flex:1}},_=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";n=""!==n?"".concat(e?"from":"to"," ").concat(n):"",console.info(e?"%c \u2193":"%c \u2191","color: ".concat(e?"green":"red"),t,n)},S={iceServers:[{urls:"turn:34.224.213.192:3478",username:"xpeed",credential:"xpeed123"}]};var C=function(e){var t=Object(s.g)().room,n=Object(c.useState)(!1),r=Object(p.a)(n,2),a=r[0],i=r[1],u=Object(c.useState)(null),d=Object(p.a)(u,2),l=d[0],v=d[1],h=Object(c.useState)(null),g=Object(p.a)(h,2),w=g[0],C=g[1],D=Object(c.useState)([]),I=Object(p.a)(D,2),T=I[0],E=I[1],z=Object(c.useRef)([]),R=function(e){z.current=e,E(e)},P=Object(c.useState)(!1),V=Object(p.a)(P,2),F=V[0],q=V[1],L=Object(c.useState)(!0),M=Object(p.a)(L,2),J=M[0],U=M[1],A=Object(c.useState)(null),B=Object(p.a)(A,2),G=B[0],W=B[1],Y=Object(c.useState)({}),H=Object(p.a)(Y,2),K=H[0],Q=H[1],X=Object(c.useRef)(),Z=function(e,t){var n,c,r;z.current.find((function(t){return t.id===e}))?R(z.current.map((function(n){return n.id===e&&(n=Object(m.a)(Object(m.a)({},n),t)),n}))):(t.name=null!==(n=t.name)&&void 0!==n?n:"",t.email=null!==(c=t.email)&&void 0!==c?c:"email",t.id=null!==(r=t.id)&&void 0!==r?r:e,R([].concat(Object(b.a)(z.current),[t])))},$=function(e){R(z.current.filter((function(t){return t.id!==e})))},ee=function(e){var t=z.current.find((function(t){return t.id===e}))||{};return t.peer?t.peer:null},te=function(e){K.id!==e.id&&Q(e)},ne=function(){var e=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new RTCPeerConnection(S),w.stream.getTracks().forEach((function(e){return n.addTrack(e,w.stream)})),n.onicecandidate=function(e){e&&e.candidate&&(G.emit("candidate",{to:t,candidate:e.candidate}),_(!1,"candidate",t))},n.onnegotiationneeded=function(){var e=Object(f.a)(j.a.mark((function e(c){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.createOffer();case 2:return r=e.sent,e.next=5,n.setLocalDescription(r);case 5:G.emit("offer",{to:t,offer:n.localDescription}),_(!1,"offer",t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.ontrack=function(e){Z(t,{stream:e.streams[0]}),_(!0,"stream",t)},_(!1,"offer",t),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=Object(f.a)(j.a.mark((function e(t,n){var c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=new RTCPeerConnection(S),w.stream.getTracks().forEach((function(e){return c.addTrack(e,w.stream)})),c.onicecandidate=function(e){e&&e.candidate&&(G.emit("candidate",{to:t,candidate:e.candidate}),_(!1,"candidate",t))},c.ontrack=function(e){Z(t,{stream:e.streams[0]}),_(!0,"stream",t)},e.next=6,c.setRemoteDescription(new RTCSessionDescription(n));case 6:return e.t0=c,e.next=9,c.createAnswer();case 9:return e.t1=e.sent,e.next=12,e.t0.setLocalDescription.call(e.t0,e.t1);case 12:return G.emit("answer",{to:t,answer:c.localDescription}),_(!1,"answer",t),e.abrupt("return",c);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),re=function(){var e=Object(f.a)(j.a.mark((function e(){var t=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.length>0&&void 0!==t[0]?t[0]:0,e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 4:e.sent,i(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),i(!1);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=Object(f.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t={video:[],audio:[]},navigator.mediaDevices.enumerateDevices().then(function(){var e=Object(f.a)(j.a.mark((function e(n){var c,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c=0;c<n.length;c++)r=n[c],a={info:r},"audioinput"===r.kind&&t.audio.push(a),"videoinput"===r.kind&&t.video.push(a);v(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}catch(n){alert(n.message)}case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=Object(f.a)(j.a.mark((function e(t){var n,c,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},n=w||{self:!0},n=Object(m.a)(Object(m.a)({},n),t),c=[],!t.audio&&!t.video){e.next=17;break}return w&&w.stream.getTracks().forEach((function(e){return e.stop()})),e.next=8,navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:n.audio}}});case 8:return r=e.sent.getTracks(),e.next=11,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:n.video}}});case 11:a=e.sent.getTracks(),c=(c=c.concat(r)).concat(a),n.stream=new MediaStream(c),n.audio_muted=!1,n.video_muted=!1;case 17:C(n),w||Q(n);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){a?ae():re(0)}),[a]),Object(c.useEffect)((function(){!G&&w&&function(){var e={room_id:t,name:w.name},n=x()("https://xpd.herokuapp.com/conference",{query:e});W(n)}(),w&&z.current.forEach((function(e){var t=e.peer,n=w.stream.getTracks();t.getSenders().forEach(function(){var e=Object(f.a)(j.a.mark((function e(t){var c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n.find((function(e){return e.kind===t.track.kind})),e.next=3,t.replaceTrack(c);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}),[w]),Object(c.useEffect)((function(){G&&w&&(G.on("join",function(){var e=Object(f.a)(j.a.mark((function e(t){var n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id&&t.name){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,ne(t.id);case 4:n=e.sent,c={id:t.id,name:t.name,peer:n},Z(t.id,c),_(!0,"join",t.id);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),G.on("candidate",function(){var e=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ee(t.from)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.addIceCandidate(new RTCIceCandidate(t.candidate));case 5:_(!0,"candidate",t.from);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),G.on("answer",function(){var e=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.from){e.next=2;break}return e.abrupt("return");case 2:if(n=ee(t.from)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,n.setRemoteDescription(new RTCSessionDescription(t.answer));case 7:_(!0,"answer",t.from);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),G.on("offer",function(){var e=Object(f.a)(j.a.mark((function e(t){var n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.from&&t.name){e.next=2;break}return e.abrupt("return");case 2:return _(!0,"offer",t.from),e.next=5,ce(t.from,t.offer);case 5:n=e.sent,c={id:t.from,name:t.name,peer:n},Z(t.from,c);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),G.on("audio_mute",(function(e){Z(e.id,{audio_muted:e.muted})})),G.on("video_mute",(function(e){Z(e.id,{video_muted:e.muted})})),G.on("detached",function(){var e=Object(f.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),G.on("connect",(function(e){console.log("connected")})),G.emit("join"))}),[G]),Object(c.useEffect)((function(){K&&K.stream&&X.current&&(Object.is(X.current.sercObject,K.stream)||(X.current.srcObject=K.stream,X.current.play(),X.current.muted=!0))}),[K]),Object(c.useEffect)((function(){!T.length&&w&&Q(w)}),[T]),a?l?l&&!w?Object(o.jsx)(o.Fragment,{children:Object(o.jsx)("div",{id:"page",className:"room",style:Object(m.a)(Object(m.a)({},N.page),{},{backgroundImage:"url(https://loremflickr.com/1080/720/black)"}),children:Object(o.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=new FormData(e.target),n=t.get("name"),c=t.get("email"),r=t.get("audio"),a=t.get("video");ie({name:n,email:c,audio:r,video:a})},className:"login-form",children:[Object(o.jsx)("h3",{children:"Get Started"}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Name"}),Object(o.jsx)("input",{type:"text",name:"name",placeholder:"please enter name",required:!0,defaultValue:y.a.name.findName()})]}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Email"}),Object(o.jsx)("input",{type:"email",name:"email",placeholder:"please enter email",required:!0,defaultValue:y.a.internet.email()})]}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Select video source"}),Object(o.jsx)("select",{name:"video",children:l.video.map((function(e){return Object(o.jsx)("option",{value:e.info.deviceId,children:e.info.label},e.deviceId)}))})]}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Select audio source"}),Object(o.jsx)("select",{name:"audio",children:l.audio.map((function(e){return Object(o.jsx)("option",{value:e.info.deviceId,children:e.info.label},e.deviceId)}))})]}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Room"}),Object(o.jsx)("input",{disabled:!0,type:"text",name:"name",placeholder:"please enter name",required:!0,defaultValue:t})]}),Object(o.jsx)("div",{className:"input-group",children:Object(o.jsx)("button",{type:"submit",children:"Enter"})})]})})}):Object(o.jsxs)("div",{id:"page",className:"room",style:N.page,children:[Object(o.jsxs)("div",{style:N.content,className:"content",children:[Object(o.jsxs)("div",{className:"pin-user-details",children:[Object(o.jsxs)("span",{children:[K.name," ",K.self?"(you)":""]}),Object(o.jsx)("i",{})]}),Object(o.jsx)("video",{ref:X}),Object(o.jsx)(k,Object(m.a)(Object(m.a)({},w),{},{onPinVideo:te}))]}),Object(o.jsxs)("div",{className:"bottom",children:[Object(o.jsxs)("div",{children:[Object(o.jsx)(O.a,{size:16}),Object(o.jsxs)("div",{children:[Object(o.jsxs)("span",{className:"title",children:["You are in ",t," room"]}),Object(o.jsxs)("span",{children:[T.length," together with you"]})]})]}),Object(o.jsx)("button",{className:"".concat(w.audio_muted?"active":""),onClick:function(e){(e=!w.audio_muted,w.stream)&&(w.stream.getAudioTracks()[0].enabled=!e);C(Object(m.a)(Object(m.a)({},w),{},{audio_muted:e})),G.emit("audio_mute",e)},children:w.audio_muted?Object(o.jsx)(O.e,{size:20}):Object(o.jsx)(O.f,{size:20})}),Object(o.jsx)("button",{className:"".concat(w.video_muted?"active":""),onClick:function(e){(e=!w.video_muted,w.stream)&&(w.stream.getVideoTracks()[0].enabled=!e);C(Object(m.a)(Object(m.a)({},w),{},{video_muted:e})),G.emit("video_mute",e)},children:w.video_muted?Object(o.jsx)(O.i,{size:20}):Object(o.jsx)(O.j,{size:20})}),Object(o.jsx)("button",{className:"".concat(F?"active":""),onClick:function(e){return q(!F)},children:F?Object(o.jsx)(O.b,{size:20}):Object(o.jsx)(O.h,{size:20})}),Object(o.jsx)("button",{style:{display:"none"},className:"".concat(J?"active":""),onClick:function(e){return U(!J)},children:J?Object(o.jsx)(O.b,{size:20}):Object(o.jsx)(O.g,{size:20})}),Object(o.jsx)("button",{children:Object(o.jsx)(O.c,{size:20})}),Object(o.jsx)("button",{className:"drop-btn",onClick:function(e){return window.location.href="/"},children:Object(o.jsx)(O.d,{size:20})})]}),F&&Object(o.jsx)("div",{className:"settings-popup",children:Object(o.jsxs)("div",{className:"container",children:[Object(o.jsx)("h3",{children:"Settings"}),Object(o.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=new FormData(e.target),n=t.get("audio"),c=t.get("video");ie({audio:n,video:c}),q(!1)},children:[Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Select video source"}),Object(o.jsx)("select",{name:"video",defaultValue:w.video,children:l.video.map((function(e){return Object(o.jsx)("option",{value:e.info.deviceId,children:e.info.label},e.deviceId)}))})]}),Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsx)("label",{children:"Select audio source"}),Object(o.jsx)("select",{name:"audio",defaultValue:w.audio,children:l.audio.map((function(e){return Object(o.jsx)("option",{value:e.info.deviceId,children:e.info.label},e.deviceId)}))})]}),Object(o.jsx)("div",{className:"input-group",children:Object(o.jsxs)("div",{children:[Object(o.jsx)("button",{variant:"danger",type:"button",onClick:function(e){return q(!1)},children:"Close"}),Object(o.jsx)("button",{type:"submit",children:"Save"})]})})]})]})}),J&&Object(o.jsx)("div",{className:"user-thumbs",children:T.map((function(e){return Object(c.createElement)(k,Object(m.a)(Object(m.a)({},e),{},{key:e.id,onPinVideo:te}))}))})]}):Object(o.jsx)("div",{id:"page",className:"room",style:Object(m.a)(Object(m.a)({},N.page),{},{backgroundImage:"url(https://loremflickr.com/1080/720/black)"}),children:Object(o.jsxs)("div",{className:"login-form",children:[Object(o.jsx)("h3",{children:"Please wait.."}),Object(o.jsx)("p",{children:"While loading devices"})]})}):Object(o.jsx)("div",{id:"page",className:"room",style:Object(m.a)(Object(m.a)({},N.page),{},{backgroundImage:"url(https://loremflickr.com/1080/720/black)"}),children:Object(o.jsxs)("div",{className:"login-form",children:[Object(o.jsx)("h3",{children:"Permission required"}),Object(o.jsx)("p",{children:"Need permission to continue."})]})})};var D=function(){return Object(o.jsx)(i.a,{children:Object(o.jsxs)(s.c,{children:[Object(o.jsx)(s.a,{path:"/:room",component:C}),Object(o.jsx)(s.a,{path:"/",component:d})]})})},I=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,1604)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),c(e),r(e),a(e),i(e)}))};a.a.render(Object(o.jsx)(D,{}),document.getElementById("root")),I()},73:function(e,t,n){}},[[1602,1,2]]]);
//# sourceMappingURL=main.977f97ad.chunk.js.map